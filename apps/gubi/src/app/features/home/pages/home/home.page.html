<div class="flex flex-col gap-1">
  <h1 class="text-2xl font-bold">Visão Geral</h1>
  <p class="text-md text-neutral-500">Acesse as últimas informações cadastradas nos seus espaços</p>
</div>

<div class="mt-8">
  @if(isLoading()) {
  <div class="flex items-center justify-center h-40">
    <app-loading [isLoading]="isLoading" />
  </div>
  } @else if(allSpendings() && allSpendings().length > 0) {
  <p-timeline [value]="allSpendings()" align="left">
    <ng-template #marker let-event>
      <span class="flex size-8 items-center justify-center rounded-full p-2 shadow-sm bg-red text-white" [ngClass]="billGuard(event) ? 'bg-[#607D8B]' : 'bg-[#9C27B0]'">
        <i [class]="billGuard(event) ? 'pi pi-money-bill' : 'pi pi-wallet'"></i>
      </span>
    </ng-template>
    <ng-template #content let-event>
      <div class="mb-6">
        <div class="flex flex-col items-start text-xs">
          <div class="flex items-center gap-1 text-neutral-800">
            <app-user-avatar [users]="event.creator"></app-user-avatar>
            <span class="font-semibold">{{ event.creator?.fullname }}</span>
            <span>criou essa {{ expenseGuard(event) ? 'despesa' : 'conta' }}</span>
          </div>
          <span class="text-neutral-500">{{ event.created_at | date: 'medium' }}</span>
        </div>
        <a
          class="mt-2 bg-card bg-white rounded-lg border shadow-sm cursor-pointer hover:shadow-md p-4 h-50 flex flex-col justify-between text-neutral-500 font-semibold transition-shadow"
          [href]="'spaces/' + event.space.id"
        >
          <div class="flex flex-col gap-1">
            <div class="flex gap-3 items-center justify-between">
              <h1 class="text-lg text-neutral-800 font-bold line-clamp-1">{{ expenseGuard(event) ? event.title : event.name }}</h1>
              <div class="flex items-center rounded-full border px-2 py-1 text-xs font-semibold border-transparent bg-black text-white leading-none">
                {{ expenseGuard(event) ? 'Despesa' : 'Conta' }}
              </div>
            </div>
            <div class="flex items-center justify-between gap-2 text-sm">
              <div class="flex items-center gap-2">
                <i class="pi pi-building"></i>
                <span class="truncate">{{ event.space.name }}</span>
              </div>
              @if(event.space.members && event.space.members.length > 1) {
              <app-user-avatar [users]="getusersFromMembers(event.space.members)" [size]="'large'"></app-user-avatar>
              }
            </div>
          </div>

          <div class="flex items-center gap-2 justify-between">
            <div class="pt-8 flex flex-col justify-end gap-3 text-sm leading-none">
              @if(expenseGuard(event) && event.payment_method_id) {
              <div class="flex items-center gap-2">
                <i class="pi pi-calendar"></i>
                <span class="font-semibold">{{ (expenseGuard(event) ? event.date : '') | date: 'dd/MM/yyyy' }}</span>
              </div>
              <div class="flex items-center gap-2">
                <i class="pi pi-credit-card"></i>
                <span>{{ event.payment_method.name }}</span>
              </div>
              } @else if(billGuard(event)) {
              <div class="flex items-center gap-2" [ngClass]="event.paid_at ? 'text-green-600' : 'text-red-600'">
                <i [ngClass]="event.paid_at ? 'pi pi-check' : 'pi pi-calendar'"></i>
                <span class="font-semibold">{{ event.paid_at ? 'Pago em ' + (event.paid_at | date: 'dd/MM/yyyy') : 'Vence em ' + (event.deadline | date: 'dd/MM/yyyy') }}</span>
              </div>
              } @if(event.space.members && event.space.members.length > 1) {
              <div class="flex items-center gap-2">
                <i class="pi pi-users"></i>
                <span>{{ 'Dividido entre ' + event.space.members.length + ' membros' }}</span>
              </div>
              } @else {
              <div class="flex items-center gap-2">
                <i class="pi pi-user"></i>
                <span>Espaço individual</span>
              </div>
              }
            </div>

            <div class="flex flex-col items-end justify-start">
              <div class="text-2xl text-neutral-800 font-bold">{{ (getUserSpending(event)) | currency: 'BRL' }}</div>
              @if(event.space.members && event.space.members.length > 1) {
              <div class="text-xs">de {{ event.value | currency: 'BRL'}}</div>
              }
            </div>
          </div>

          @if(expenseGuard(event) && event.note) {
          <div class="mt-3 flex items-center gap-2 p-2 bg-neutral-100 rounded-md border">
            <i class="pi pi-book"></i>
            <span class="line-clamp-1">{{ event.note }}</span>
          </div>
          }
        </a>
      </div>
    </ng-template>
  </p-timeline>
  @if(currentPage() < totalPages()) {
  <p-button class="mt-2 w-full flex justify-center" label="Carregar mais" severity="secondary" rounded (click)="loadMore()" />
  } } @else if(!allSpendings() || allSpendings().length === 0) {
  <div class="flex flex-col items-center justify-center h-60 text-center gap-4">
    <i class="pi pi-inbox text-6xl text-neutral-400"></i>
    <h2 class="text-xl font-semibold text-neutral-700">Nenhuma atividade recente</h2>
    <p class="text-md text-neutral-500">
      Parece que não há atividades recentes nos seus espaços.<br />
      Crie despesas ou contas para ver as atualizações aqui.
    </p>
  </div>
  }
</div>
